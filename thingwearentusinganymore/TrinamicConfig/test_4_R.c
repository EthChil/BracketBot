// Motor type &  PWM configuration
tmc4671_writeInt(0, TMC4671_MOTOR_TYPE_N_POLE_PAIRS, 0x0003000F);
tmc4671_writeInt(0, TMC4671_PWM_POLARITIES, 0x00000000);
tmc4671_writeInt(0, TMC4671_PWM_MAXCNT, 0x00000F9F);
tmc4671_writeInt(0, TMC4671_PWM_BBM_H_BBM_L, 0x00002828);
tmc4671_writeInt(0, TMC4671_PWM_SV_CHOP, 0x00000007);

// ADC configuration
tmc4671_writeInt(0, TMC4671_ADC_I_SELECT, 0x18000100);
tmc4671_writeInt(0, TMC4671_dsADC_MCFG_B_MCFG_A, 0x00100010);
tmc4671_writeInt(0, TMC4671_dsADC_MCLK_A, 0x20000000);
tmc4671_writeInt(0, TMC4671_dsADC_MCLK_B, 0x20000000);
tmc4671_writeInt(0, TMC4671_dsADC_MDEC_B_MDEC_A, 0x00FF00FF);
tmc4671_writeInt(0, TMC4671_ADC_I0_SCALE_OFFSET, 0x0100813C);
tmc4671_writeInt(0, TMC4671_ADC_I1_SCALE_OFFSET, 0x01008205);

// ABN encoder settings
tmc4671_writeInt(0, TMC4671_ABN_DECODER_MODE, 0x00000000);
tmc4671_writeInt(0, TMC4671_ABN_DECODER_PPR, 0x00002000);
tmc4671_writeInt(0, TMC4671_ABN_DECODER_COUNT, 0x00000825); //DIFF
tmc4671_writeInt(0, TMC4671_ABN_DECODER_PHI_E_PHI_M_OFFSET, 0x00000000);

// Limits
tmc4671_writeInt(0, TMC4671_PID_TORQUE_FLUX_LIMITS, 0x00000BB8);
tmc4671_writeInt(0, TMC4671_PID_VELOCITY_LIMIT, 0x000000C8);


// PI settings for flux and torque
tmc4671_writeInt(0, TMC4671_PID_TORQUE_P_TORQUE_I, 0x03201388);
tmc4671_writeInt(0, TMC4671_PID_FLUX_P_FLUX_I, 0x019009C4);
// PI settings for velocity and position
tmc4671_writeInt(0, TMC4671_PID_VELOCITY_P_VELOCITY_I, 0x4E20015E); //DIFF
tmc4671_writeInt(0, TMC4671_PID_POSITION_P_POSITION_I, 0x00160000);



// ===== ABN encoder test drive =====

// Init encoder (mode 0)
tmc4671_writeInt(0, TMC4671_MODE_RAMP_MODE_MOTION, 0x00000008);
tmc4671_writeInt(0, TMC4671_ABN_DECODER_PHI_E_PHI_M_OFFSET, 0x00000000);
tmc4671_writeInt(0, TMC4671_PHI_E_SELECTION, 0x00000001);
tmc4671_writeInt(0, TMC4671_PHI_E_EXT, 0x00000000);
tmc4671_writeInt(0, TMC4671_UQ_UD_EXT, 0x00000000);
wait(1000);
tmc4671_writeInt(0, TMC4671_ABN_DECODER_COUNT, 0x00000000);

// Feedback selection
tmc4671_writeInt(0, TMC4671_PHI_E_SELECTION, 0x00000003);
tmc4671_writeInt(0, TMC4671_VELOCITY_SELECTION, 0x00000009);

//set to stop by default
tmc4671_writeInt(0, TMC4671_MODE_RAMP_MODE_MOTION, 0x00000000);
tmc4671_writeInt(0, TMC4671_POSITION_SELECTION, 0x00000009);
